<!DOCTYPE html>
<html lang="zh">
    <head>
    <!--
        © Material Theme
        https://github.com/viosey/hexo-theme-material
        Version: 1.3.4 -->

    <!-- Title -->
    
    <title>
        
            R如何找对象？ - PART II | 
        
        Hexo
    </title>

    <!-- Meta & Info -->
    <meta charset="utf-8">

    <!-- dns prefetch -->
    <meta http-equiv="x-dns-prefetch-control" content="on">
    
    
    
    
    
    

    <meta http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#0097A7">
    <meta name="author" content="John Doe">
    <meta name="description" content="null">
    <meta name="keywords" content="null,R,译文,environment">

    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/favicon.png">
    <link rel="icon" sizes="192x192" href="/img/favicon.png">
    <link rel="apple-touch-icon" href="/img/favicon.png">

    <!--iOS -->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-title" content="Title">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="480">

    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Hexo">

    <!-- The Open Graph protocol -->
    <meta property="og:url" content="http://yoursite.com">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="R如何找对象？ - PART II | Hexo">
    <meta property="og:description" content="null">
    <meta property="og:article:tag" content="R"> <meta property="og:article:tag" content="译文"> <meta property="og:article:tag" content="environment"> 

    <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.zhCN.js"></script>
        
    <![endif]-->

    <!-- Import CSS & jQuery -->
    
        <link rel="stylesheet" href="/css/material.min.css">
        <link rel="stylesheet" href="/css/style.min.css">
        <!-- Config CSS -->


<!-- Other Styles -->
<style>
  body, html {
    font-family: Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
  }

  a {
    color: #00838F;
  }

  .mdl-card__media,
  #search-label,
  #search-form-label:after,
  #scheme-Paradox .hot_tags-count,
  #scheme-Paradox .sidebar_archives-count,
  #scheme-Paradox .sidebar-colored .sidebar-header,
  #scheme-Paradox .sidebar-colored .sidebar-badge{
    background-color: #0097A7 !important;
  }

  /* Sidebar User Drop Down Menu Text Color */
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus {
    color: #0097A7 !important;
  }

  #post_entry-right-info,
  .sidebar-colored .sidebar-nav li:hover > a,
  .sidebar-colored .sidebar-nav li:hover > a i,
  .sidebar-colored .sidebar-nav li > a:hover,
  .sidebar-colored .sidebar-nav li > a:hover i,
  .sidebar-colored .sidebar-nav li > a:focus i,
  .sidebar-colored .sidebar-nav > .open > a,
  .sidebar-colored .sidebar-nav > .open > a:hover,
  .sidebar-colored .sidebar-nav > .open > a:focus,
  #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a {
    color: #0097A7 !important;
  }

  .toTop {
    background: #757575 !important;
  }

  .material-layout .material-post>.material-nav,
  .material-layout .material-index>.material-nav,
  .material-nav a {
    color: #757575;
  }

  #scheme-Paradox .MD-burger-layer {
    background-color: #757575;
  }

  #scheme-Paradox #post-toc-trigger-btn {
    color: #757575;
  }

  .post-toc a:hover {
    color: #00838F;
    text-decoration: underline;
  }

</style>


<!-- Theme Background Related-->

    <style>
      body{
        background-color: #F5F5F5;
      }

      /* blog_info bottom background */
      #scheme-Paradox .material-layout .something-else .mdl-card__supporting-text{
        background-color: #fff;
      }
    </style>




<!-- Fade Effect -->

    <style>
      .fade {
        transition: all 800ms linear;
        -webkit-transform: translate3d(0,0,0);
        -moz-transform: translate3d(0,0,0);
        -ms-transform: translate3d(0,0,0);
        -o-transform: translate3d(0,0,0);
        transform: translate3d(0,0,0);
        opacity: 1;
      }

      .fade.out{
        opacity: 0;
      }
    </style>


        <script src="/js/jquery.min.js"></script>
        <script src="/js/queue.js"></script>
    

    <!-- UC Browser Compatible -->
    <script>
        var agent = navigator.userAgent.toLowerCase();
        if(agent.indexOf('ucbrowser')>0) {
            document.write("<link rel=\"stylesheet\" href=\"/css/uc.css\">");
            alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
        }
    </script>

    

    


    <!-- Bing Background -->
    

    <!-- Custom Head -->
    
</head>


    
        <body id="scheme-Paradox" class="lazy">
            <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
                

                <!-- Main Container -->
                <main class="material-layout__content" id="main">

                    <!-- Top Anchor -->
                    <div id="top"></div>

                    
                        <!-- Hamburger Button -->
                        <button class="MD-burger-icon sidebar-toggle">
                            <span class="MD-burger-layer"></span>
                        </button>
                    

                    <!-- Post TOC -->

    
    <!-- Back Button -->
    <!--
    <div class="material-back" id="backhome-div" tabindex="0">
        <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"
           href="#" onclick="window.history.back();return false;"
           target="_self"
           role="button"
           data-upgraded=",MaterialButton,MaterialRipple">
            <i class="material-icons" role="presentation">arrow_back</i>
            <span class="mdl-button__ripple-container">
                <span class="mdl-ripple"></span>
            </span>
        </a>
    </div>
    -->

    <!-- Left aligned menu below button -->
    <button id="post-toc-trigger-btn"
        class="mdl-button mdl-js-button mdl-button--icon">
        <i class="material-icons">format_list_numbered</i>
    </button>

    <ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="post-toc-trigger-btn" style="max-height:80vh; overflow-y:scroll;">
        <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#undefined"><span class="post-toc-number">1.</span> <span class="post-toc-text">紫色虚线</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#undefined"><span class="post-toc-number">2.</span> <span class="post-toc-text">传递函数</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#undefined"><span class="post-toc-number">3.</span> <span class="post-toc-text">别理那个调用者(caller)</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#undefined"><span class="post-toc-number">4.</span> <span class="post-toc-text">终于，R怎么找对象呢？</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#undefined"><span class="post-toc-number">5.</span> <span class="post-toc-text">原文</span></a></li></ol>

        <!--
        <li class="mdl-menu__item">
            Some Action
        </li>
        -->
    </ul>




<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">

        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
    <!-- Paradox Post Header -->
    
        
            <!-- Random Thumbnail -->
            <div class="post_thumbnail-random mdl-card__media mdl-color-text--grey-50">
            <script>
    var randomNum = Math.floor(Math.random() * 19 + 1);

    $('.post_thumbnail-random').attr('data-original', '/img/random/material-' + randomNum + '.png');
    $('.post_thumbnail-random').addClass('lazy');
</script>

        
    
            <p class="article-headline-p">
                R如何找对象？ - PART II
            </p>
        </div>





                
                    <!-- Paradox Post Info -->
                    <div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">

    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/img/avatar.png" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>John Doe</strong>
        <span>1月 24, 2016</span>
    </div>

    <div class="section-spacer"></div>

    <!-- Favorite -->
    <!--
        <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
            <i class="material-icons" role="presentation">favorite</i>
            <span class="visuallyhidden">favorites</span>
        </button>
    -->

    <!-- Qrcode -->
    

    <!-- Tags (bookmark) -->
    
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
        <i class="material-icons" role="presentation">bookmark</i>
        <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
        <li class="mdl-menu__item">
        <a class="post_tag-link" href="/tags/R/">R</a></li><li class="mdl-menu__item"><a class="post_tag-link" href="/tags/environment/">environment</a></li><li class="mdl-menu__item"><a class="post_tag-link" href="/tags/译文/">译文</a>
    </ul>
    

    <!-- Share -->
    <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    

    

    <!-- Share Weibo -->
    
        <a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=R如何找对象？ - PART II&url=http://yoursite.com//2016/01/24/Codage-20-how-r-searches-and-finds-stuff-2/index.html&pic=&searchPic=false&style=simple" target="_blank">
            <li class="mdl-menu__item">
                分享到微博
            </li>
        </a>
    

    <!-- Share Twitter -->
    
        <a class="post_share-link" href="https://twitter.com/intent/tweet?text=R如何找对象？ - PART II&url=http://yoursite.com//2016/01/24/Codage-20-how-r-searches-and-finds-stuff-2/index.html&via=John Doe" target="_blank">
            <li class="mdl-menu__item">
                分享到 Twitter
            </li>
        </a>
    

    <!-- Share Facebook -->
    
        <a class="post_share-link" href="https://www.facebook.com/sharer/sharer.php?u=http://yoursite.com//2016/01/24/Codage-20-how-r-searches-and-finds-stuff-2/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Facebook
            </li>
        </a>
    

    <!-- Share Google+ -->
    
        <a class="post_share-link" href="https://plus.google.com/share?url=http://yoursite.com//2016/01/24/Codage-20-how-r-searches-and-finds-stuff-2/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Google+
            </li>
        </a>
    

    <!-- Share LinkedIn -->
    

    <!-- Share QQ -->
    

    <!-- Share Telegram -->
    
</ul>

</div>

                

                <!-- Post Content -->
                <div id="post-content" class="mdl-color-text--grey-700 mdl-card__supporting-text fade out">
    
        <p>上一部分(你以为我想拆成两部分啊，太长了啊 o(╯□╰)o)讲到了</p>
<ul>
<li>环境(空环境、全局环境、封装环境、包的关联环境、<code>namespace:base</code>)</li>
<li>R的检索路线</li>
<li>依赖项和导入项的区别</li>
</ul>
<p>&lt;!-- more --&gt;</p>
<h2>紫色虚线</h2>
<p>跟其它对象一样，函数也住在环境中。而函数自身也有个<strong>指针属性</strong>，指向它们可以运行的环境。当你创建一个函数时，这个属性被自动设定为指向函数创建的环境。所以函数创建和<strong>将要</strong>运行的环境，是一样儿一样儿的。</p>
<p><img src="http://7xndoy.com1.z0.glb.clouddn.com/Codage-20-img1-environment-property.png" alt="img1"></p>
<p>“函数将要运行的环境”是什么意思呢？
上一部分曾经提到，函数一旦运行就会创建一个其特有的环境。我们也提到过每个环境都有一个封装环境。那么是哪个环境封装了函数的新环境呢？
这个封装环境被函数的<strong>环境属性</strong>所指定。这个环境也是“函数将要运行的环境”。它<em>并不一定</em>是拥有函数的环境。它被函数的环境属性控制。</p>
<p>我们可以通过<code>environment()</code>来获得函数对象的环境属性(回想一下，第一部分我们提到<code>environment()</code>只以函数作为输入参数)。</p>
<p><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">MyFunction &lt;- <span class="keyword">function</span>() &#123;&#125; </div><div class="line">environment(MyFunction)</div></pre></td></tr></table></figure></p>
<pre><code>## &lt;environment: R_GlobalEnv&gt;
</code></pre>
<p>运行<code>MyFunction()</code>时，R在执行函数定义的<code>{}</code>中的语句，环境则如下图所示：</p>
<p><img src="http://7xndoy.com1.z0.glb.clouddn.com/Codage-20-img2-environment-execution.png" alt="img2"></p>
<p>默认情况下，R将函数的环境属性设置为函数被创建的环境(拥有此函数的环境)。但函数的执行环境和拥有函数的环境并不一定非得是一样的。要不，换一个环境试试看？</p>
<p><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">MyFunction &lt;- <span class="keyword">function</span>() &#123; &#125; </div><div class="line">newEnvironment &lt;- new.env() </div><div class="line">environment(MyFunction) &lt;- newEnvironment </div><div class="line">environment(MyFunction)</div></pre></td></tr></table></figure></p>
<pre><code>## &lt;environment: 0x000000000e895628&gt;
</code></pre>
<p>上面的代码执行以后，<code>environment(MyFunction)</code>已经不再返回<code>R_GlobalEnv</code>了。</p>
<p>另一种查看函数的环境属性的方法是直接打印这个函数。</p>
<p><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">MyFunction</div></pre></td></tr></table></figure></p>
<pre><code>## function() { } 
## &lt;environment: 0x000000000e895628&gt;
</code></pre>
<p>对函数<code>sd()</code>做同样的操作：</p>
<p><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">environment(sd)</div></pre></td></tr></table></figure></p>
<pre><code>## &lt;environment: namespace:stats&gt; 
</code></pre>
<p><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sd</div></pre></td></tr></table></figure></p>
<pre><code>## function (x, na.rm = FALSE) 
## { 
##   ... (removed for brevity) 
## } 
## &lt;bytecode: 000000000E7F2EA0&gt;
## &lt;environment: namespace:stats&gt;
</code></pre>
<p>再来看下面这段代码：</p>
<p><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">age &lt;- <span class="number">32</span> </div><div class="line"></div><div class="line">MyFunction &lt;- <span class="keyword">function</span>()&#123; </div><div class="line">    age &lt;- <span class="number">22</span> </div><div class="line">    FromLocal &lt;- <span class="keyword">function</span>() &#123;print(age + <span class="number">1</span>)&#125; </div><div class="line">    FromGlobal &lt;- <span class="keyword">function</span>() &#123;print(age + <span class="number">1</span>)&#125; </div><div class="line">    NoSearch &lt;-  <span class="keyword">function</span>() &#123;age &lt;- <span class="number">11</span>; print(age + <span class="number">1</span>)&#125; </div><div class="line">    environment(FromGlobal) &lt;- .GlobalEnv </div><div class="line">    FromLocal() </div><div class="line">    FromGlobal() </div><div class="line">    NoSearch()</div><div class="line">&#125; </div><div class="line"></div><div class="line">MyFunction()</div></pre></td></tr></table></figure></p>
<pre><code>## [1] 23 
## [1] 33 
## [1] 12
</code></pre>
<p>这段代码是如何运作的？</p>
<ol>
<li><code>FromLocal()</code>的封装环境是<code>MyFunciton()</code>(内部)的环境，也就是<code>FromLocal()</code>被创建的环境，这也是R以默认规则执行的结果。
当R查找<code>FromLocal()</code>中的<code>age</code>变量时，(由于<code>FromLocal()</code>内并没有此变量的赋值，)它会找到<code>MyFunction()</code>的环境中，抓取<code>age &lt;- 22</code>然后对这个变量加1；</li>
<li><code>FromGlobal()</code>的封装环境是<code>R_GlobalEnv</code>因为我们用<code>environment()</code>函数将<code>.GlobalEnv</code>赋值给了它的环境属性。R在<code>FromGlobal()</code>内部查找不到<code>age</code>变量的赋值，便向其封装环境发起查找，抓取<code>R_GlobalEnv</code>中的语句<code>age &lt;- 32</code>并在此变量基础上加1；</li>
<li><code>NoSearch()</code>内部已经有了<code>age</code>对象，所以这个函数可以直接在其衍生的内部环境中找到想要的变量而不用向它被封装的环境求助。</li>
</ol>
<p>这解释了我们地图里的那些紫色虚线。
如果你在<code>package:&lt;name&gt;</code>环境中检视函数的环境属性，你会看到他们全部指向<code>namespace:&lt;name&gt;</code>环境。</p>
<p>让我们来验证一下：
获取<code>package:stats</code>中的标准差函数并查看它的环境属性。</p>
<p><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">statsPackageEnv &lt;- as.environment(<span class="string">"package:stats"</span>) </div><div class="line">sdFunc &lt;- get(<span class="string">"sd"</span>, envir = statsPackageEnv) </div><div class="line">environment(sdFunc)</div></pre></td></tr></table></figure></p>
<pre><code>## &lt;environment: namespace:stats&gt; 
</code></pre>
<p><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">statsNamespaceEnv &lt;- environment(sdFunc) </div><div class="line">sdFunc2 &lt;- get(<span class="string">"sd"</span>, envir = statsNamespaceEnv) </div><div class="line">environment(sdFunc2)</div></pre></td></tr></table></figure></p>
<pre><code>## &lt;environment: namespace:stats&gt; 
</code></pre>
<p>注意到<code>sd()</code>的环境属性指向<code>namespace:stats</code>。</p>
<p>这里也有更简单的办法获取一个命名空间的环境。</p>
<p><figure class="highlight r"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">statsNamespaceEnv &lt;- asNamespace(<span class="string">"stats"</span>) </div><div class="line">statsNamespaceEnv</div></pre></td></tr></table></figure></p>
<pre><code>## &lt;environment: namespace:stats&gt; 
</code></pre>
<p>所以，本质上讲，包的环境只是通往命名空间环境的通道而已。
包的环境会说“我不知道做啥，问我的函数”。
当我们问函数时，他们会说“当你执行我们的时候，你创建了一个新的环境，它的封装环境就是命名空间的环境。”
更准确地讲，函数只是贡献出了它们的环境属性。
我们也可以让这些虚线变成实线：</p>
<p><img src="http://7xndoy.com1.z0.glb.clouddn.com/Codage-20-img3-map-of-the-world-complete.png" alt="img3"></p>
<p>碰巧这是另一种对“为什么对一个对象查询拥有它的环境没有简便方法”的解释。
当我们在一个环境中执行语句的时候，我们会关注它所拥有的对象，因为我们可能会用到其中的一个。当我们找到一个函数，我们也应当知道它应该在哪个环境下执行。
但在我们的工作流程中，并不是每一个对象我们都应当判定拥有它的环境是什么(并不是那么重要)。</p>
<p>如果你现在已经晕晕乎乎了，我建议你停下来，重新读一遍这一小节。函数的执行，是整块拼图里最复杂的一个碎片。</p>
<h2>传递函数</h2>
<p>(可选择直接跳过此小节)</p>
<p>因为函数有一个环境属性，所以它们可以被传递。将一个函数传递给另一个函数，是一个可以让你抓耳挠腮(也很强大)的特征。我们就不在这条道上黑太远了。
从一个较高的层面，你可以这样思考：
如果一个函数<code>FunctionA(someOtherFunction)</code>以另一个函数<code>someOtherFunction()</code>做参数，那么<code>FunctionA()</code>在它运行的方式上一定跟其它函数有些不同。这种不同被执行<code>someOtherFunction()</code>的过程所控制。我们编写<code>someOtherFunction()</code>的时候就期望它以一种特殊的方式运行。它应该有能力获取其被创建的环境内的所有对象，即使当它被移交给<code>FunctionA()</code>之后，这种能力仍然保留。
R虽然为<code>FunctionA()</code>创建了一个新环境，但这并不能妨碍以上功能的实现。
当<code>someOtherFunction()</code>最终被运行的时候，R检索此函数的环境属性，并在此环境中执行，而并非在<code>FunctionA()</code>的内部环境中运行。所以之前提到的能力仍能够被支持。
事实上，<code>FunctionA()</code>也能将<code>someOtherFunction()</code>传递给<code>FunctionB()</code>，后者也能将其传递给<code>FunctionC()</code>且<code>FunctionC()</code>不与<code>someOtherFunction()</code>的运行结果有直接联系。这是有关函数环境属性的魔法。</p>
<h2>别理那个调用者(caller)</h2>
<p>我们讨论到的查找机制不会用到调用栈。
调用栈是从代码开始运行到你当前所在的计算所涉及到的函数调用的序列。比如，<code>FunctionA()</code>调用<code>FunctionB()</code>，后者调用<code>FunctionC()</code>。那么调用栈就依调用的先后顺序将一个函数置于另一个之上。
思考查找机制的问题时，错误的思路就是顺着调用的顺序找。
假设<code>FunctionC()</code>会执行<code>FunctionD()</code>。按照调用的思路，如果<code>FunctionD()</code>不是在<code>FunctionC()</code>的执行环境中定义的，那么就需要在<code>FunctionB()</code>的执行环境中查找，然后是<code>FuctionA()</code>。
正确的方法应该是问自己“谁拥有<code>FunctionC</code>？”如果拥有者(owner)对<code>FunctionD()</code>一无所知，那么有可能拥有者的拥有者(owner's owner)知道，以此类推。</p>
<p>问题是，直觉上我们更倾向按调用栈(调用链)的思路去思考，而不是依照封装环境的链条。
需要记住的是，无论R何时估算一行代码，系统总是站在两条重要的环境链的顶端(也可能是底端，顶端易脑补)。一条是封装环境链，它涉及到一个范围问题，比如，如果当前环境的框架下找不到特定的变量名，接下来应该去哪里查找。这是我们关心的链条。另一条是调用栈，它是在一系列的函数调用中产生的。你可以忽略掉这个链条。只有在用到一些特殊的R函数时，才有必要通过这个链条去找一个变量。这些应用场景不在本文的讨论范围内。</p>
<p><strong>注意</strong>：R(或一些R的读物)在两种链条的文档中都用到“母系”(parent)这个词条。<code>parent.env()</code>函数是我们已经谈过的用来寻找封装环境的函数，而<code>parent.frame()</code>函数用于查询调用栈。这种用词和函数命名肯定会让人疑惑而且也是一个历史的疏忽。“母系”一次不应被用作封装环境的替代品，而只应用在调用栈上。</p>
<h2>终于，R怎么找对象呢？</h2>
<p>R只是顺着那条紫色的公路找呀~
要不我们再看一个例子好了。</p>
<p>假设我们在找<code>ggplot()</code>函数。我们从<code>R_GlobalEnv</code>找起。如果<code>ggplot()</code>不在全局环境中，那它一定在一个包里。所以R遍历查询列表试图找到这个函数。这便是一个直观的封装环境链。最终R在一个包的环境中找到这个函数。尽管<code>ggplot()</code>是在包的环境(package environment)中找到的，R仍然在命名空间的环境(namespace environment)中执行这个函数，一如我们在上一节中讲到的一样。</p>
<p>如果此时<code>ggplot()</code>调用了另一个函数<code>MyFunction()</code>，则会发生以下事情：</p>
<ol>
<li>如果<code>MyFunction()</code>是在<code>ggplot()</code>内定义的，那么我们马上能够找到它，因为R首先在本地环境(local environment)中查找。这里，本地环境是运行<code>ggplot()</code>时创建的环境。</li>
<li>如果没有找到，那么R会去<code>MyFunction()</code>的执行环境的封装环境(<code>namespace:ggplot2</code>)中查找。如果我们能找到<code>MyFunction()</code>，那么这种情况是同一个包里的一个函数调用另一个函数。</li>
<li>如果<code>namespace:ggplot2</code>里也找不到<code>MyFunction()</code>，那么R会检查命名空间的环境(namespace environment)的封装环境，也就是导入项的环境(imports environment)。这样<code>ggplot()</code>就有机会在一些明确要求的依赖包里查找<code>MyFunction()</code>函数。可参见我们在第一部分提到过的<code>ggplot2</code>查找<code>plyr</code>中函数的例子。</li>
<li>如果仍不能找到，那么我们就要去导入项环境的封装环境中查找，也就是<code>namespace:base</code>。你可以在这里找到基础函数(如<code>sd()</code>)，然后结束查找。</li>
<li>如果<code>namespace:base</code>中也没有<code>MyFunction()</code>，那我们就要回到查询列表了。我们从<code>R_GlobalEnv</code>找起。当然这并不大可能。如果一个包期望用户在全局环境里定义函数，那使用这个包一定是个很差的体验。当然，用户可以以此为机会通过在全局环境里定义自己的<code>MyFunction()</code>函数来打断查找路线。</li>
<li>如果<code>MyFunction()</code>存在于<code>ggplot2</code>的依赖包中，且这个依赖包存在于帮助文档中<code>Depends</code>项，而不是<code>Imports</code>项，那么我们能在查找列表中找到<code>MyFunction()</code>。此情况类似于前文提到的<code>ggplot()</code>寻找<code>reshape</code>包中的函数的例子。我们也要寄希望于没有其它的包以同样的名字定义了一个函数，这个包被加载的位置也不能太靠近全局环境(<code>reshape2</code>的案例)。</li>
</ol>
<p>总之你只需要知道什么是<em>当前</em>或<em>本地</em>环境，然后顺着封装环境链一直查找下去，如此往复。</p>
<h2>原文</h2>
<p><a href="http://blog.obeautifulcode.com/R/How-R-Searches-And-Finds-Stuff/" target="_blank" rel="external">How R Searches and Finds Stuff</a></p>

    

    
</div>


                

                <!-- Post Comments -->
                
                    







                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    <!-- Prev Nav -->
    
        <a href="/2016/01/23/Codage-19-how-r-searches-and-finds-stuff-1/" id="post_nav-newer" class="prev-content">
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_back</i>
            </button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            新篇
        </a>
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/2016/02/02/Langage-1-francais-grammaire-1/" id="post_nav-older" class="next-content">
            旧篇
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>

        </div>
    </div>



                    
                        <!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay"></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation">
    <div id="sidebar-main">
        <!-- Sidebar Header -->
        <div class="sidebar-header header-cover" style="background-image: url(/img/sidebar_header.png);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
        <i class="material-icons">clear_all</i>
        <span class="mdl-button__ripple-container">
            <span class="mdl-ripple">
            </span>
        </span>
    </button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="/img/avatar.png" alt="John Doe's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        youremail@email.com
        <b class="caret"></b>
    </a>
</div>


        <!-- Sidebar Navigation  -->
        <ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
            
                <li>
                    <a href="#" target="_blank" title="Email Me">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i>
                        
                        Email Me
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    
        <li id="sidebar-first-li">
            <a href="/" target="_self">
                
                    <i class="material-icons sidebar-material-icons">home</i>
                
                主页
            </a>
        </li>
        
    

    <!-- Archives  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                    归档
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
            <li>
                <a class="sidebar_archives-link" href="/archives/2017/04/">四月 2017<span class="sidebar_archives-count">28</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/03/">三月 2017<span class="sidebar_archives-count">37</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/02/">二月 2017<span class="sidebar_archives-count">12</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/01/">一月 2017<span class="sidebar_archives-count">12</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/12/">十二月 2016<span class="sidebar_archives-count">18</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/11/">十一月 2016<span class="sidebar_archives-count">24</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/10/">十月 2016<span class="sidebar_archives-count">39</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/09/">九月 2016<span class="sidebar_archives-count">32</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/08/">八月 2016<span class="sidebar_archives-count">32</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/07/">七月 2016<span class="sidebar_archives-count">21</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/06/">六月 2016<span class="sidebar_archives-count">33</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/05/">五月 2016<span class="sidebar_archives-count">20</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/04/">四月 2016<span class="sidebar_archives-count">15</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/03/">三月 2016<span class="sidebar_archives-count">19</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/02/">二月 2016<span class="sidebar_archives-count">16</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/01/">一月 2016<span class="sidebar_archives-count">19</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/12/">十二月 2015<span class="sidebar_archives-count">20</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/11/">十一月 2015<span class="sidebar_archives-count">30</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/10/">十月 2015<span class="sidebar_archives-count">30</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/09/">九月 2015<span class="sidebar_archives-count">27</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/08/">八月 2015<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/07/">七月 2015<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/06/">六月 2015<span class="sidebar_archives-count">10</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/05/">五月 2015<span class="sidebar_archives-count">7</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/04/">四月 2015<span class="sidebar_archives-count">11</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/03/">三月 2015<span class="sidebar_archives-count">10</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/02/">二月 2015<span class="sidebar_archives-count">14</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/01/">一月 2015<span class="sidebar_archives-count">6</span></a></li><li><a class="sidebar_archives-link" href="/archives/2014/12/">十二月 2014<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2014/11/">十一月 2014<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2014/10/">十月 2014<span class="sidebar_archives-count">6</span></a></li><li><a class="sidebar_archives-link" href="/archives/2014/09/">九月 2014<span class="sidebar_archives-count">6</span></a></li><li><a class="sidebar_archives-link" href="/archives/2014/08/">八月 2014<span class="sidebar_archives-count">9</span></a></li><li><a class="sidebar_archives-link" href="/archives/2014/07/">七月 2014<span class="sidebar_archives-count">6</span></a></li><li><a class="sidebar_archives-link" href="/archives/2014/06/">六月 2014<span class="sidebar_archives-count">7</span></a></li><li><a class="sidebar_archives-link" href="/archives/2014/05/">五月 2014<span class="sidebar_archives-count">11</span></a></li><li><a class="sidebar_archives-link" href="/archives/2014/04/">四月 2014<span class="sidebar_archives-count">32</span></a></li><li><a class="sidebar_archives-link" href="/archives/2014/03/">三月 2014<span class="sidebar_archives-count">34</span></a></li><li><a class="sidebar_archives-link" href="/archives/2014/02/">二月 2014<span class="sidebar_archives-count">14</span></a></li><li><a class="sidebar_archives-link" href="/archives/2014/01/">一月 2014<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2013/12/">十二月 2013<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2013/07/">七月 2013<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2013/06/">六月 2013<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2013/04/">四月 2013<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2013/03/">三月 2013<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2013/02/">二月 2013<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2013/01/">一月 2013<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2012/12/">十二月 2012<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2012/10/">十月 2012<span class="sidebar_archives-count">6</span></a></li><li><a class="sidebar_archives-link" href="/archives/2012/09/">九月 2012<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2012/07/">七月 2012<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2012/06/">六月 2012<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2012/05/">五月 2012<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2011/08/">八月 2011<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2011/07/">七月 2011<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2011/06/">六月 2011<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2011/05/">五月 2011<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2011/04/">四月 2011<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2011/03/">三月 2011<span class="sidebar_archives-count">5</span></a></li><li><a class="sidebar_archives-link" href="/archives/2011/02/">二月 2011<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2010/12/">十二月 2010<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2010/11/">十一月 2010<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2010/09/">九月 2010<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2010/07/">七月 2010<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2010/06/">六月 2010<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2010/02/">二月 2010<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2010/01/">一月 2010<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2009/09/">九月 2009<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2009/07/">七月 2009<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2009/05/">五月 2009<span class="sidebar_archives-count">5</span></a></li><li><a class="sidebar_archives-link" href="/archives/2009/04/">四月 2009<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2009/03/">三月 2009<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2009/02/">二月 2009<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2008/07/">七月 2008<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2008/06/">六月 2008<span class="sidebar_archives-count">1</span></a>
            </ul>
        </li>
        
    

    <!-- Categories  -->
    

    <!-- Pages  -->
    

    <!-- Article Number  -->
    
</ul>


        <!-- Sidebar Footer -->
        <!--
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持和动力。 :)
-->

<!-- Sidebar Divider -->

    <div class="sidebar-divider"></div>


<!-- Theme Material -->

    <a href="https://github.com/viosey/hexo-theme-material"  class="sidebar-footer-text-a" target="_blank">
        <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
            主题 - Material
            <span class="sidebar-badge badge-circle">i</span>
        </div>
    </a>


<!-- Help & Support -->
<!--

-->

<!-- Feedback -->
<!--

-->

<!-- About Theme -->
<!--

-->

    </div>

    <!-- Sidebar Image -->
    

</aside>

                    

                    
                        <!-- Footer Top Button -->
                        <div class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>

                    

                    <!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
    
        <!-- Paradox Footer Left Section -->
        <div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    
        <a href="https://twitter.com/twitter" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-twitter.svg);">
                <span class="visuallyhidden">Twitter</span>
            </button><!--
     --></a>
    

    <!-- Facebook -->
    
        <a href="https://www.facebook.com/facebook" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-facebook.svg);">
                <span class="visuallyhidden">Facebook</span>
            </button><!--
     --></a>
    

    <!-- Google + -->
    
        <a href="https://www.google.com/" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-gplus.svg);">
                <span class="visuallyhidden">Google Plus</span>
            </button><!--
     --></a>
    

    <!-- Weibo -->
    

    <!-- Instagram -->
    

    <!-- Tumblr -->
    

    <!-- Github -->
    

    <!-- LinkedIn -->
    

    <!-- Zhihu -->
    

    <!-- Bilibili -->
    

    <!-- Telegram -->
    
</div>


        <!--Copyright-->
        <div id="copyright">
            Copyright&nbsp;©&nbsp;
            <script type="text/javascript">
                var fd = new Date();
                document.write(fd.getFullYear());
            </script>
            &nbsp;Hexo
        </div>

        <!-- Paradox Footer Right Section -->

        <!--
        I am glad you use this theme, the development is no so easy, I hope you can keep the copyright.
        It will not impact the appearance and can give developers a lot of support :)

        很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
        它不会影响美观并可以给开发者很大的支持。 :)
        -->

        <div class="mdl-mini-footer--right-section">
            <div>
                <div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
                <div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
            </div>
        </div>
    
</footer>


                    <!-- Import File -->

    <script src="/js/lazyload.min.js"></script>
    <script src="/js/js.min.js"></script>



    <script src="/js/nprogress.js"></script>


<script type="text/javascript">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    $('#nprogress .bar').css({
        'background': '#29d'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #29d, 0 0 15px #29d'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#29d',
        'border-left-color': '#29d'
    });
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>
















<!-- Window Load-->
<script>
    $(window).load(function() {
        // Post_Toc parent position fixed
        $('.post-toc-wrap').parent('.mdl-menu__container').css('position', 'fixed');
    });
</script>

<!-- MathJax Load-->

<script>
    <!-- Offer LazyLoad -->
    queue.offer(function(){
        $('.lazy').lazyload({
            effect : 'show'
        });
    });

    <!-- Start Queue -->
    $(document).ready(function(){
        setInterval(function(){
            queue.execNext();
        },200);
    });
</script>

                </main>
            </div>
        </body>
    
</html>
