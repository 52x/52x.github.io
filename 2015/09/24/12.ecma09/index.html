<!DOCTYPE html>
<html lang="zh">
    <head>
    <!--
        © Material Theme
        https://github.com/viosey/hexo-theme-material
        Version: 1.3.4 -->

    <!-- Title -->
    
    <title>
        
            JavaScript 读书心得之九：数据检索（XMLHttpRequest） | 
        
        Hexo
    </title>

    <!-- Meta & Info -->
    <meta charset="utf-8">

    <!-- dns prefetch -->
    <meta http-equiv="x-dns-prefetch-control" content="on">
    
    
    
    
    
    

    <meta http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#0097A7">
    <meta name="author" content="John Doe">
    <meta name="description" content="null">
    <meta name="keywords" content="null,JavaScript">

    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/favicon.png">
    <link rel="icon" sizes="192x192" href="/img/favicon.png">
    <link rel="apple-touch-icon" href="/img/favicon.png">

    <!--iOS -->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-title" content="Title">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="480">

    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Hexo">

    <!-- The Open Graph protocol -->
    <meta property="og:url" content="http://yoursite.com">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="JavaScript 读书心得之九：数据检索（XMLHttpRequest） | Hexo">
    <meta property="og:description" content="null">
    <meta property="og:article:tag" content="JavaScript"> 

    <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.zhCN.js"></script>
        
    <![endif]-->

    <!-- Import CSS & jQuery -->
    
        <link rel="stylesheet" href="/css/material.min.css">
        <link rel="stylesheet" href="/css/style.min.css">
        <!-- Config CSS -->


<!-- Other Styles -->
<style>
  body, html {
    font-family: Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
  }

  a {
    color: #00838F;
  }

  .mdl-card__media,
  #search-label,
  #search-form-label:after,
  #scheme-Paradox .hot_tags-count,
  #scheme-Paradox .sidebar_archives-count,
  #scheme-Paradox .sidebar-colored .sidebar-header,
  #scheme-Paradox .sidebar-colored .sidebar-badge{
    background-color: #0097A7 !important;
  }

  /* Sidebar User Drop Down Menu Text Color */
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus {
    color: #0097A7 !important;
  }

  #post_entry-right-info,
  .sidebar-colored .sidebar-nav li:hover > a,
  .sidebar-colored .sidebar-nav li:hover > a i,
  .sidebar-colored .sidebar-nav li > a:hover,
  .sidebar-colored .sidebar-nav li > a:hover i,
  .sidebar-colored .sidebar-nav li > a:focus i,
  .sidebar-colored .sidebar-nav > .open > a,
  .sidebar-colored .sidebar-nav > .open > a:hover,
  .sidebar-colored .sidebar-nav > .open > a:focus,
  #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a {
    color: #0097A7 !important;
  }

  .toTop {
    background: #757575 !important;
  }

  .material-layout .material-post>.material-nav,
  .material-layout .material-index>.material-nav,
  .material-nav a {
    color: #757575;
  }

  #scheme-Paradox .MD-burger-layer {
    background-color: #757575;
  }

  #scheme-Paradox #post-toc-trigger-btn {
    color: #757575;
  }

  .post-toc a:hover {
    color: #00838F;
    text-decoration: underline;
  }

</style>


<!-- Theme Background Related-->

    <style>
      body{
        background-color: #F5F5F5;
      }

      /* blog_info bottom background */
      #scheme-Paradox .material-layout .something-else .mdl-card__supporting-text{
        background-color: #fff;
      }
    </style>




<!-- Fade Effect -->

    <style>
      .fade {
        transition: all 800ms linear;
        -webkit-transform: translate3d(0,0,0);
        -moz-transform: translate3d(0,0,0);
        -ms-transform: translate3d(0,0,0);
        -o-transform: translate3d(0,0,0);
        transform: translate3d(0,0,0);
        opacity: 1;
      }

      .fade.out{
        opacity: 0;
      }
    </style>


        <script src="/js/jquery.min.js"></script>
        <script src="/js/queue.js"></script>
    

    <!-- UC Browser Compatible -->
    <script>
        var agent = navigator.userAgent.toLowerCase();
        if(agent.indexOf('ucbrowser')>0) {
            document.write("<link rel=\"stylesheet\" href=\"/css/uc.css\">");
            alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
        }
    </script>

    

    


    <!-- Bing Background -->
    

    <!-- Custom Head -->
    
</head>


    
        <body id="scheme-Paradox" class="lazy">
            <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
                

                <!-- Main Container -->
                <main class="material-layout__content" id="main">

                    <!-- Top Anchor -->
                    <div id="top"></div>

                    
                        <!-- Hamburger Button -->
                        <button class="MD-burger-icon sidebar-toggle">
                            <span class="MD-burger-layer"></span>
                        </button>
                    

                    <!-- Post TOC -->

    
    <!-- Back Button -->
    <!--
    <div class="material-back" id="backhome-div" tabindex="0">
        <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"
           href="#" onclick="window.history.back();return false;"
           target="_self"
           role="button"
           data-upgraded=",MaterialButton,MaterialRipple">
            <i class="material-icons" role="presentation">arrow_back</i>
            <span class="mdl-button__ripple-container">
                <span class="mdl-ripple"></span>
            </span>
        </a>
    </div>
    -->

    <!-- Left aligned menu below button -->
    <button id="post-toc-trigger-btn"
        class="mdl-button mdl-js-button mdl-button--icon">
        <i class="material-icons">format_list_numbered</i>
    </button>

    <ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="post-toc-trigger-btn" style="max-height:80vh; overflow-y:scroll;">
        <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#undefined"><span class="post-toc-number">1.</span> <span class="post-toc-text">不刷新页面之 AJAX</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#undefined"><span class="post-toc-number">2.</span> <span class="post-toc-text">不刷新页面之 iframe</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#undefined"><span class="post-toc-number">3.</span> <span class="post-toc-text">HTTP 请求</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#undefined"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">创建 XMLHttpRequest 对象</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#undefined"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">打开新请求</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#undefined"><span class="post-toc-number">3.3.</span> <span class="post-toc-text">指定数据返回时的处理动作</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#undefined"><span class="post-toc-number">3.4.</span> <span class="post-toc-text">发送请求</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#undefined"><span class="post-toc-number">3.5.</span> <span class="post-toc-text">上述四步的综合应用</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#undefined"><span class="post-toc-number">4.</span> <span class="post-toc-text">取消 HTTP 请求</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#undefined"><span class="post-toc-number">5.</span> <span class="post-toc-text">处理响应信息</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#undefined"><span class="post-toc-number">5.1.</span> <span class="post-toc-text">响应信息的格式</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#undefined"><span class="post-toc-number">5.2.</span> <span class="post-toc-text">一般规则</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#undefined"><span class="post-toc-number">6.</span> <span class="post-toc-text">可访问性</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#undefined"><span class="post-toc-number">7.</span> <span class="post-toc-text">跨域请求实现的方式</span></a></li></ol>

        <!--
        <li class="mdl-menu__item">
            Some Action
        </li>
        -->
    </ul>




<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">

        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
    <!-- Paradox Post Header -->
    
        
            <!-- Random Thumbnail -->
            <div class="post_thumbnail-random mdl-card__media mdl-color-text--grey-50">
            <script>
    var randomNum = Math.floor(Math.random() * 19 + 1);

    $('.post_thumbnail-random').attr('data-original', '/img/random/material-' + randomNum + '.png');
    $('.post_thumbnail-random').addClass('lazy');
</script>

        
    
            <p class="article-headline-p">
                JavaScript 读书心得之九：数据检索（XMLHttpRequest）
            </p>
        </div>





                
                    <!-- Paradox Post Info -->
                    <div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">

    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/img/avatar.png" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>John Doe</strong>
        <span>9月 25, 2015</span>
    </div>

    <div class="section-spacer"></div>

    <!-- Favorite -->
    <!--
        <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
            <i class="material-icons" role="presentation">favorite</i>
            <span class="visuallyhidden">favorites</span>
        </button>
    -->

    <!-- Qrcode -->
    

    <!-- Tags (bookmark) -->
    
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
        <i class="material-icons" role="presentation">bookmark</i>
        <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
        <li class="mdl-menu__item">
        <a class="post_tag-link" href="/tags/JavaScript/">JavaScript</a>
    </ul>
    

    <!-- Share -->
    <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    

    

    <!-- Share Weibo -->
    
        <a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=JavaScript 读书心得之九：数据检索（XMLHttpRequest）&url=http://yoursite.com//2015/09/24/12.ecma09/index.html&pic=&searchPic=false&style=simple" target="_blank">
            <li class="mdl-menu__item">
                分享到微博
            </li>
        </a>
    

    <!-- Share Twitter -->
    
        <a class="post_share-link" href="https://twitter.com/intent/tweet?text=JavaScript 读书心得之九：数据检索（XMLHttpRequest）&url=http://yoursite.com//2015/09/24/12.ecma09/index.html&via=John Doe" target="_blank">
            <li class="mdl-menu__item">
                分享到 Twitter
            </li>
        </a>
    

    <!-- Share Facebook -->
    
        <a class="post_share-link" href="https://www.facebook.com/sharer/sharer.php?u=http://yoursite.com//2015/09/24/12.ecma09/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Facebook
            </li>
        </a>
    

    <!-- Share Google+ -->
    
        <a class="post_share-link" href="https://plus.google.com/share?url=http://yoursite.com//2015/09/24/12.ecma09/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Google+
            </li>
        </a>
    

    <!-- Share LinkedIn -->
    

    <!-- Share QQ -->
    

    <!-- Share Telegram -->
    
</ul>

</div>

                

                <!-- Post Content -->
                <div id="post-content" class="mdl-color-text--grey-700 mdl-card__supporting-text fade out">
    
        <h2>不刷新页面之 AJAX</h2>
<p>有时候，我们需要在不刷新页面的情况下从服务器检索数据，这就用到了 XMLHttpRequest 对象，所有浏览器都支持它（IE6- 把它作为一个 ActiveX 对象，其他浏览器则把它作为原生对象，内建了对它的支持），我们把这种技术叫 AJAX（Asynchronous Javascript And XML）</p>
<blockquote>
<p>注：XMLHttpRequest 是 Ajax 应用程序中使用的基本对象。听起来它似乎是为通过 HTTP 请求发送 XML 或者以某种 XML 格式发出 HTTP 请求而设计的。但实际上它要做的只不过是为客户端脚本提供一种发送 HTTP 请求的方式，仅此而已。XMLHttpRequest 对象更多的是在不重新加载页面的情况下发出请求，而不会太多地涉及 XML 甚至 HTTP。所以它的更准确的名称应该为 HttpRequest。</p>
</blockquote>
<h2>不刷新页面之 iframe</h2>
<p>不刷新页面检索数据也可以使用隐藏帧技术（包括 frame 和 iframe），实现原理就是创建一个包含用于客户端—服务器通信的隐藏帧，当主页面进行数据提交时，通过对隐藏帧的 JavaScript 函数调用，使得隐藏帧对服务器进行请求和处理响应，并把响应数据返回给主页面。</p>
<p>优点：它可以维护浏览器的历史，使用户仍然能够使用浏览器上的后退和前进按钮。浏览器由于并不知道隐藏帧实际上被隐藏了，但对于其所发出的请求仍然是记录在案的。由于主页面没有修改，而只有在隐藏帧中的修改，这意味着后退和前进按钮将依据该隐藏帧的访问历史而非主页面而变化。这也是为什么 Gmail 和 Google Maps 仍然使用该技术的理由。注：iframe 并非一直会存储浏览器的历史记录。尽管 IE 始终会存储 iframe 的历史记录，但 Firefox 只对使用 HTML 定义（也就是不包括使用 JavaScript 动态创建）的 iframe 保存历史记录。Safari 从不为 iframe 保存历史记录，不管它们是如何包含在该页面中的。</p>
<p>缺点：对其背后发生的事了解甚少。它完全依赖于返回的正确页面。如果隐藏帧的页面载入失败，并不会向用户提示出错消息，主页面将继续等待直到调用适当的 JavaScript 函数。必须通过设置一个较长周期（可能是 5 分钟）的超时时间，然后如果页面仍然没有成功载入则显示一条消息，以给用户一个安慰。但这一切都只是一个变通方法，最主要的问题是，对于后台发生的 HTTP 请求缺乏充足的信息。这是它不如 XMLHttpRequest 的地方。</p>
<h2>HTTP 请求</h2>
<p>通过 XMLHttpRequest 对象发送 HTTP 请求需要以下四个步骤：</p>
<ol start="0">
<li>创建一个 XMLHttpRequest 对象</li>
<li>指示该对象打开一个新请求（调用 open() 方法）</li>
<li>指示该对象如何处理服务器的返回数据（绑定 readystatechange 事件处理函数）</li>
<li>指示该对象发送请求（调用 send() 方法）</li>
</ol>
<h3>创建 XMLHttpRequest 对象</h3>
<p>首先创建一个数组，它包含了创建 XMLHttpRequest 对象的所有可能方式所对应的函数。首先尝试创建原生对象，其次尝试创建 ActiveX 对象，MSXML2、MSXML3、Microsoft 都是对象可能的名字，它们哪个可用取决于用户的系统配置而不是浏览器
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> XMLHttps = [</div><div class="line">    <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="keyword">return</span> <span class="keyword">new</span> XMLHttpRequest() &#125;,</div><div class="line">    <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="keyword">return</span> <span class="keyword">new</span> ActiveXObject(<span class="string">"MSXML2.XMLHTTP"</span>) &#125;,</div><div class="line">    <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="keyword">return</span> <span class="keyword">new</span> ActiveXObject(<span class="string">"MSXML3.XMLHTTP"</span>) &#125;,</div><div class="line">    <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="keyword">return</span> <span class="keyword">new</span> ActiveXObject(<span class="string">"Microsoft.XMLHTTP"</span>) &#125;</div><div class="line">]</div></pre></td></tr></table></figure></p>
<p>其次使用函数遍历数组尝试每种方式，如果其中之一成功就会创建一个 XMLHttpRequest 对象，而所有都失败的话，返回 false
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">createXMLHttp</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> xmlhttp = <span class="literal">false</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; XMLHttps.length; i++) &#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            xmlhttp = XMLHttps[i]();</div><div class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</div><div class="line">            <span class="keyword">continue</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">break</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> xmlhttp;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>注：最近学习到 jquery 的写法，可以一行创建 XMLHttpRequest 对象
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> xmlhttp = <span class="built_in">window</span>.ActiveXObject ? <span class="keyword">new</span> ActiveXObject(<span class="string">"Microsoft.XMLHTTP"</span>) : <span class="keyword">new</span> XMLHttpRequest();</div></pre></td></tr></table></figure></p>
<h3>打开新请求</h3>
<p>使用 open() 方法打开一个新请求，这是为发送请求而做的准备
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">xmlhttp.open(method,url,<span class="literal">true</span>);</div></pre></td></tr></table></figure></p>
<ul>
<li>method 参数定义请求的方法：GET、POST 或 HEAD。GET 是把数据作为查询字符串追加在 URL 上；POST 是让数据随着 HTTP 请求的正文发送；HEAD 是请求只返回 HTTP 响应的头信息，而不是文件本身，偶尔会用到它</li>
<li>url 参数定义将被下载的文件路径</li>
<li>最后一个参数是告诉浏览器使用异步请求（true）还是同步请求（false）</li>
</ul>
<h3>指定数据返回时的处理动作</h3>
<p>调用 open() 方法后，应该指定当返回数据（响应信息）时浏览器的处理动作，这时要使用 <code>readystatechange</code> 事件来绑定事件处理函数
这时需要了解 HTTP 就绪状态，它表示请求的状态或情形。用于确定该请求是否已经开始、是否得到了响应或者请求 / 响应模型是否已经完成。还可以帮助确定读取服务器提供的响应文本或数据是否安全。</p>
<blockquote>
<p>共有五种就绪状态：</p>
</blockquote>
<table>
<thead>
<tr>
<th>值</th>
<th>传统值</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>uninitialized</td>
<td>未初始化（已创建对象，但还没有调用 open() 方法）</td>
</tr>
<tr>
<td>1</td>
<td>loading</td>
<td>加载中（已调用 open() 方法，但还没有调用 send() 方法）</td>
</tr>
<tr>
<td>2</td>
<td>loaded</td>
<td>已加载（已调用 send() 方法，但服务器还没有响应即状态和头信息不可用）</td>
</tr>
<tr>
<td>3</td>
<td>interactive</td>
<td>交互（已经接收到部分响应信息）注：IE 不支持</td>
</tr>
<tr>
<td>4</td>
<td>complete</td>
<td>完成（所有响应信息接收完毕）</td>
</tr>
</tbody>
</table>
<p>每当 HTTP 就绪状态改变时它都会触发 readystatechange 事件</p>
<blockquote>
<p>注：readystatechange 事件的 type 属性在 IE 中为 load，而不是 readystatechange</p>
</blockquote>
<h3>发送请求</h3>
<p>调用 open() 方法并设置了 readystatechange 事件处理函数后，就可以发送请求了
<code>xmlhttp.send(date);</code>
请求时需要一个参数。如果使用 POST 方法，参数就是传递的数据；如果是 GET 方法，参数为 null</p>
<h3>上述四步的综合应用</h3>
<p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> xhrStates = [<span class="string">"正在初始化……"</span>,<span class="string">"正在初始化请求…… 成功！"</span>,<span class="string">"正在发送请求…… 成功！"</span>,<span class="string">"正在接收数据…… 完成！"</span>,<span class="string">"正在解析数据…… 完成！"</span>];</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">sendRequest</span>(<span class="params">url, callback, postData</span>) </span>&#123;</div><div class="line">    <span class="comment">// 首先创建一个 XMLHttpRequest 对象</span></div><div class="line">    <span class="keyword">var</span> xhr = <span class="built_in">window</span>.ActiveXObject ? <span class="keyword">new</span> ActiveXObject(<span class="string">"Microsoft.XMLHTTP"</span>) : <span class="keyword">new</span> XMLHttpRequest();</div><div class="line">    <span class="keyword">if</span> (!xhr) &#123;</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// 检查 postData 参数是否存在。存在，设置请求方法为 POST；不存在，设置为 GET</span></div><div class="line">    <span class="keyword">var</span> method = (postData) ? <span class="string">"POST"</span> : <span class="string">"GET"</span>;</div><div class="line">    xhr.open(method,url,<span class="literal">true</span>);</div><div class="line">    <span class="comment">// 使用 setRequestHeader() 方法可以设置 HTTP 请求的头信息：http://www.w3.org/Protocols/rfc2616/rfc2616-sec5.html#sec5.3</span></div><div class="line">    <span class="comment">// 这里设置 User-Agent 头信息为 XMLHTTP，便于服务器端的脚本分辨出 XMLHttp 请求和其他普通请求</span></div><div class="line">    xhr.setRequestHeader(<span class="string">'User-Agent'</span>,<span class="string">'XMLHTTP'</span>);</div><div class="line">    <span class="comment">// 使用 POST 方法时，必须设置如下一个头信息</span></div><div class="line">    <span class="keyword">if</span> (postData) &#123;</div><div class="line">        xhr.setRequestHeader(<span class="string">'Content-type'</span>,<span class="string">'application/x-www-form-urlencoded'</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// 绑定 readystatechange 事件处理函数来处理响应信息</span></div><div class="line">    xhr.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="comment">// 该对象请求的就绪状态发生变化时，处理程序被触发，首先就是查看 readyState 值，如果响应未完成（不为 4），则返回</span></div><div class="line">        <span class="keyword">if</span> (xhr.readyState != <span class="number">4</span>) &#123;</div><div class="line">            <span class="comment">//return;</span></div><div class="line">            alert(xhrStates[xhr.readyState]);</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// 其次查看 status 属性，它包含服务器返回的 HTTP 响应的状态码，正常时返回值为 200（Opera 中有时为 304），本地测试时返回值为 0：http://www.w3.org/Protocols/rfc2616/rfc2616-sec6.html#sec6.1.1、http://en.wikipedia.org/wiki/List_of_HTTP_status_codes</span></div><div class="line">        <span class="comment">// 如果不正常，则返回</span></div><div class="line">        <span class="keyword">if</span> (xhr.status != <span class="number">200</span> &amp;&amp; xhr.status != <span class="number">304</span> &amp;&amp; xhr.status != <span class="number">0</span>) &#123;</div><div class="line">            alert(<span class="string">'HTTP error '</span> + xhr.status);</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">        callback(xhr);</div><div class="line">        <span class="comment">// 销毁，防止内存泄漏</span></div><div class="line">        xhr = <span class="literal">null</span>;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">// 检查 XMLHttpRequest 对象的 readyState 值，如果等于 4，说明文档已经存在于浏览器的缓存中，就不需要发送请求了。因为在 IE 中，请求一个存在于浏览器缓存中的文件时，会在发送请求前触发事件处理函数</span></div><div class="line">    <span class="keyword">if</span> (xhr.readyState == <span class="number">4</span>) &#123;</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    xhr.send(postData);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2>取消 HTTP 请求</h2>
<p>当对一个已经正在下载响应信息的 XMLHttpRequest 对象进行其他操作时，它会忽略之前的工作状态而开始下载新响应信息。唯一例外的是 Firefox，它需要先调用 abort() 方法
在调用 abort() 方法前，应该先移除 readystatechange 事件处理函数，因为 IE 和 Firefox 即使在取消请求后也会触发这个事件处理函数</p>
<blockquote>
<p>注：在 IE 中，不能设置为 null，只能设置为空函数
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">xmlhttp.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;;</div><div class="line">xmlhttp.abort();</div></pre></td></tr></table></figure></p>
</blockquote>
<blockquote>
<p>注：当使用了 abort() 方法，Firefox 中的 responseXML 属性就会消失，所以不推荐使用 abort() 方法</p>
</blockquote>
<h2>处理响应信息</h2>
<p>发送请求后，等待事件响应，一旦服务器返回响应信息且被正常接受时，指定的事件处理函数就被触发，执行其处理动作。</p>
<blockquote>
<p>如下，发送一个 GET 请求到 ajax.php，并附带参数 queryString 作为查询字符串，tackleData() 作为事件处理函数：
<code>sendRequest('ajax.php'+queryString,tackleData);</code></p>
</blockquote>
<p>处理响应信息时，首先要读取数据，XMLHttpRequest 对象有两个属性：<code>responseText</code>、<code>responseXML</code>，分别以文本和 XML 文档的形式保存数据，它们都可以使用 W3C DOM 方法来读取。</p>
<p>另外，XMLHttpRequest 对象还有两个方法：<code>getResponseHeader()</code>、<code>getAllResponseHeaders()</code>，可以分别读取服务器返回的某个指定的 HTTP 响应的头信息或完整列表。HTTP 头信息完整列表（包括 HTTP 请求和 HTTP 响应）：<a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html" target="_blank" rel="external">W3C</a>、<a href="http://en.wikipedia.org/wiki/List_of_HTTP_headers" target="_blank" rel="external">WIKI</a>。
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> lastModified = xmlhttp.getResponseHeader(<span class="string">"Last-Modified"</span>);</div><div class="line"><span class="keyword">var</span> allHeaders = xmlhttp.getAllResponseHeaders();</div></pre></td></tr></table></figure></p>
<h3>响应信息的格式</h3>
<p>一共有四种：XML、HTML、JSON、CSV</p>
<ol start="0">
<li>
<p>使用 responseXML 返回 XML 文档
必须在返回文档是 XML 时可用，即声明它的 MIME 文件类型为 “text/xml” 注，现在不推荐使用，而是用 “<a href="http://annevankesteren.nl/2004/08/mime-types" target="_blank" rel="external">application/xml</a>”）
当把所有 HTML 文档都设置为 “text/xml” 时，会遇到问题，因为，任何非 XMLHttp 请求的 HTML 文档必须设置为 “text/html” 才能被浏览器正确显示
这也就是前面设置 User-Agent 头信息为 XMLHTTP 的原因：服务器端的脚本如果识别出该头信息，就能以 text/xml 格式返回 HTML 文档，而不是 text/html</p>
<p>优点：对 XML 文件可以完全沿用 W3C DOM 方法和属性，而不需要学习新知识
缺点：创建包含这些数据的 HTML 结构时，服务器端的响应脚本和浏览器端的解析脚本变得相当冗长</p>
<p>XML 文档格式
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">main</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">message</span>&gt;</span>You are make a mistake!<span class="tag">&lt;/<span class="name">message</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">speed</span>&gt;</span>200<span class="tag">&lt;/<span class="name">speed</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">main</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">xml</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">tackleData</span>(<span class="params">obj</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> returnData = obj.responseXML;</div><div class="line">    <span class="keyword">if</span> (!returnData) &#123;</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// 可以使用 W3C DOM 方法来读取响应信息</span></div><div class="line">    <span class="keyword">var</span> message = returnData.getElementsByTagName(<span class="string">'message'</span>)[<span class="number">0</span>].firstChild;</div><div class="line">    <span class="keyword">var</span> speed = returnData.getElementsByTagName(<span class="string">'speed'</span>)[<span class="number">0</span>].firstChild;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
</li>
<li>
<p>使用 responseText 返回 HTML 文档
优点：最具可访问性的格式
缺点：不适合需要脚本操作响应信息而不是直接显示结果的应用</p>
<p>HTML 文档格式
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>You are make a mistake!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">tackleData</span>(<span class="params">obj</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> returnData = obj.responseText;</div><div class="line">    <span class="keyword">if</span> (!returnData) &#123;</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// 可以方便把响应信息加入到 HTML 文档中去</span></div><div class="line">    <span class="built_in">document</span>.getElementById(<span class="string">"msg"</span>).innerHTML = returnData;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
</li>
<li>
<p>使用 responseText 返回 JSON 文档
它返回一个解释为 JavaScript 对象的字符串，该字符串是使用对象字面量方式创建的</p>
<p>优点：更为便捷的数据访问途径；非冗长性
缺点：JSON 丢失了 XML 具有的一些特性如命名空间；由于 JSON 采用冒号赋值，这将导致当 XML 转化为 JSON 时，在标识符与实际属性值之间很难区分谁应该被当作文本考虑；对语法要求严格</p>
<p>JSON 文档格式
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"message"</span>:<span class="string">"You are make a mistake!"</span>,</div><div class="line">  <span class="attr">"speed"</span>:<span class="number">200</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">tackleData</span>(<span class="params">obj</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> returnData = <span class="built_in">eval</span>(<span class="string">"("</span>+obj.responseText+<span class="string">")"</span>);</div><div class="line">    <span class="keyword">if</span> (!returnData) &#123;</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// 可以方便读取响应信息</span></div><div class="line">    <span class="keyword">var</span> message = returnData.message;</div><div class="line">    <span class="keyword">var</span> speed = returnData.speed;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
</li>
<li>
<p>使用 responseText 返回 CSV 文档
它返回一个以逗号为分隔符的字符串
CSV（Comma-Separated Values），逗号分隔文本，是一种经常用来作为不同程序之间的数据交互格式</p>
<p>优点：最简短和高效的数据格式，各类编程语言都支持它
缺点：数据读取时无法包含数据的提示或元数据，如 message、speed 之类的标签或属性名，只能靠位置来读取它们，要求服务器端和浏览器端的配合度比较高</p>
<p>CSV 文档格式
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">You are make a mistake!,200</div></pre></td></tr></table></figure></p>
<p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">tackleData</span>(<span class="params">obj</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> returnData = obj.responseText.split(<span class="string">","</span>);</div><div class="line">    <span class="keyword">if</span> (!returnData) &#123;</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// 只能靠位置来读取响应信息</span></div><div class="line">    <span class="keyword">var</span> message = returnData[<span class="number">0</span>];</div><div class="line">    <span class="keyword">var</span> speed = returnData[<span class="number">1</span>];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
</li>
</ol>
<h3>一般规则</h3>
<p>注：可以统一访问 XMLHttpRequest.response 属性获得响应信息。</p>
<ul>
<li>需要添加大块数据到 HTML 文档中，使用 HTML 格式，它是最简单的格式</li>
<li>如果项目庞大复杂，需要多位程序员紧密协作，使用 XML 格式，它是最通用的格式</li>
<li>需要遍历一段冗长的响应信息去搜索一块很小的数据，使用 XML 或 JSON 格式，它是最快速的格式</li>
<li>不推荐使用 CSV 格式，因为它缺少元数据</li>
<li>注：在目前流行的 RESTful 架构中，推荐使用 JSON 格式，数据简洁，处理快速。</li>
</ul>
<h2>可访问性</h2>
<p>随着 Ajax 的广泛应用，在可访问性方面面临一个问题：在 JavaScript 被禁用的情况下，保持该应用能够被访问是一项艰苦的工作</p>
<p>HTML 格式是仅有的一个具有可访问性及可自我访问的。可以使用：先按普通方法来构建应用，然后用 JavaScript 截获请求，改用 XMLHttp 请求来实现的方法，以此缓解响应信息和可访问性的关系
参看：Jeremy Keith 发明的 <a href="http://domscripting.com/blog/display/41" target="_blank" rel="external">Hijax 方法</a></p>
<p>而对其他三种格式的，由于它们都不是可自我访问的，所以只能采取折衷的方案：</p>
<ol>
<li>保证使用 XMLHttp 请求的都是锦上添花的内容，而把基本的功能都留在 HTML 中，使任何人都可以访问</li>
<li>创建两个服务器端的脚本：一个针对 XMLHttp 请求返回 XML（或 JSON），另外一个针对普通请求返回纯文本的 HTML 文档；通过检查 User-Agent 头信息的值是否是 “XMLHTTP” 就可以区分这两种请求</li>
</ol>
<p>对没有使用 HTML 的 XMLHttpRequest 应用，目前没有什么好的提高可访问性的方法</p>
<h2>跨域请求实现的方式</h2>
<ul>
<li>
<p>JSONP：仅支持 GET 请求，需要服务器返回 callback 封装（Firefox-&gt;console 无法查看，因为没有使用 XMLHttpRequest 对象）
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">jsonp</span>(<span class="params">url, callback, params</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> callbackName = <span class="string">'jsonp_callback_'</span> + <span class="built_in">Math</span>.round(<span class="number">100000</span> * <span class="built_in">Math</span>.random());</div><div class="line">    <span class="built_in">window</span>[callbackName] = <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</div><div class="line">        <span class="keyword">delete</span> <span class="built_in">window</span>[callbackName];</div><div class="line">        <span class="built_in">document</span>.body.removeChild(script);</div><div class="line">        callback(data);</div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">var</span> script = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>);</div><div class="line">    params[params.callback_name] = callbackName;</div><div class="line">    script.src = url + (url.indexOf(<span class="string">'?'</span>) &gt;= <span class="number">0</span> ? <span class="string">'&amp;'</span> : <span class="string">'?'</span>) + param(params);</div><div class="line">    <span class="built_in">document</span>.body.appendChild(script);</div><div class="line">&#125;</div><div class="line">jsonp(<span class="string">'http://openapi.baidu.com/public/2.0/bmt/translate'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(data.trans_result[<span class="number">0</span>]);</div><div class="line">&#125;, &#123;</div><div class="line">    <span class="attr">callback_name</span>: <span class="string">'callback'</span>, <span class="comment">//API 接口的回调函数名称，封装用</span></div><div class="line">    client_id: <span class="string">'2ALMz6WqUEcsBg4BS91Eppq3'</span>,</div><div class="line">    <span class="attr">from</span>: <span class="string">'auto'</span>,</div><div class="line">    <span class="attr">to</span>: <span class="string">'auto'</span>,</div><div class="line">    <span class="attr">q</span>: <span class="string">'show'</span></div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
</li>
<li>
<p>CORS：支持 POST 请求，需要服务器端设置 Access-Control-Allow-Origin: *（Firebug-&gt; 响应头信息）
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">createCORSRequest</span>(<span class="params">method, url</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</div><div class="line">    <span class="keyword">if</span> (<span class="string">"withCredentials"</span> <span class="keyword">in</span> xhr) &#123;</div><div class="line">        xhr.open(method, url, <span class="literal">true</span>);</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> XDomainRequest != <span class="string">"undefined"</span>) &#123;</div><div class="line">        xhr = <span class="keyword">new</span> XDomainRequest();</div><div class="line">        xhr.open(method, url);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        xhr = <span class="literal">null</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> xhr;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeCorsRequest</span>(<span class="params">url, callback, postData</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> method = (postData) ? <span class="string">"POST"</span> : <span class="string">"GET"</span>;</div><div class="line">    <span class="keyword">var</span> xhr = createCORSRequest(method, url + <span class="string">'?'</span> + param(postData));</div><div class="line">    <span class="keyword">if</span> (!xhr) &#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'CORS not supported'</span>);</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    xhr.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        callback(xhr.response);</div><div class="line">    &#125;;</div><div class="line">    xhr.onerror = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">'error'</span>);</div><div class="line">    &#125;;</div><div class="line">    xhr.send();</div><div class="line">&#125;</div><div class="line">makeCorsRequest(<span class="string">'http://api.openweathermap.org/data/2.5/find'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(data);</div><div class="line">&#125;, &#123;</div><div class="line">    <span class="attr">q</span>: <span class="string">'beijing'</span></div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
</li>
<li>
<p>iframe</p>
</li>
<li>
<p>window.name</p>
</li>
<li>
<p>window.postMessage：HTML5 新增方法</p>
</li>
<li>
<p>Apache 和 Nginx：反向代理</p>
</li>
</ul>
<blockquote>
<p>转换参数对象为字符串格式 {a:1,b:2} =&gt; a=1&amp;b=2
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> param = <span class="function"><span class="keyword">function</span>(<span class="params">obj</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> query = <span class="string">''</span>,</div><div class="line">        name, value, fullSubName, subName, subValue, innerObj, i;</div><div class="line">    <span class="keyword">for</span> (name <span class="keyword">in</span> obj) &#123;</div><div class="line">        value = obj[name];</div><div class="line">        <span class="keyword">if</span> (value <span class="keyword">instanceof</span> <span class="built_in">Array</span>) &#123;</div><div class="line">            <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; value.length; ++i) &#123;</div><div class="line">                subValue = value[i];</div><div class="line">                fullSubName = name + <span class="string">'['</span> + i + <span class="string">']'</span>;</div><div class="line">                innerObj = &#123;&#125;;</div><div class="line">                innerObj[fullSubName] = subValue;</div><div class="line">                query += param(innerObj) + <span class="string">'&amp;'</span>;</div><div class="line">            &#125;</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (value <span class="keyword">instanceof</span> <span class="built_in">Object</span>) &#123;</div><div class="line">            <span class="keyword">for</span> (subName <span class="keyword">in</span> value) &#123;</div><div class="line">                subValue = value[subName];</div><div class="line">                fullSubName = name + <span class="string">'['</span> + subName + <span class="string">']'</span>;</div><div class="line">                innerObj = &#123;&#125;;</div><div class="line">                innerObj[fullSubName] = subValue;</div><div class="line">                query += param(innerObj) + <span class="string">'&amp;'</span>;</div><div class="line">            &#125;</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (value !== <span class="literal">undefined</span> &amp;&amp; value !== <span class="literal">null</span>)</div><div class="line">            query += <span class="built_in">encodeURIComponent</span>(name) + <span class="string">'='</span> + <span class="built_in">encodeURIComponent</span>(value) + <span class="string">'&amp;'</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> query.length ? query.substr(<span class="number">0</span>, query.length - <span class="number">1</span>) : query;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
</blockquote>

    

    
</div>


                

                <!-- Post Comments -->
                
                    







                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    <!-- Prev Nav -->
    
        <a href="/2015/09/24/Codage-5-install-jdk8-on-ubuntu/" id="post_nav-newer" class="prev-content">
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_back</i>
            </button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            新篇
        </a>
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/2015/09/25/Codage-4-data-table-way-2/" id="post_nav-older" class="next-content">
            旧篇
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>

        </div>
    </div>



                    
                        <!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay"></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation">
    <div id="sidebar-main">
        <!-- Sidebar Header -->
        <div class="sidebar-header header-cover" style="background-image: url(/img/sidebar_header.png);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
        <i class="material-icons">clear_all</i>
        <span class="mdl-button__ripple-container">
            <span class="mdl-ripple">
            </span>
        </span>
    </button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="/img/avatar.png" alt="John Doe's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        youremail@email.com
        <b class="caret"></b>
    </a>
</div>


        <!-- Sidebar Navigation  -->
        <ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
            
                <li>
                    <a href="#" target="_blank" title="Email Me">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i>
                        
                        Email Me
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    
        <li id="sidebar-first-li">
            <a href="/" target="_self">
                
                    <i class="material-icons sidebar-material-icons">home</i>
                
                主页
            </a>
        </li>
        
    

    <!-- Archives  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                    归档
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
            <li>
                <a class="sidebar_archives-link" href="/archives/2017/04/">四月 2017<span class="sidebar_archives-count">28</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/03/">三月 2017<span class="sidebar_archives-count">37</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/02/">二月 2017<span class="sidebar_archives-count">12</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/01/">一月 2017<span class="sidebar_archives-count">12</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/12/">十二月 2016<span class="sidebar_archives-count">18</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/11/">十一月 2016<span class="sidebar_archives-count">24</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/10/">十月 2016<span class="sidebar_archives-count">39</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/09/">九月 2016<span class="sidebar_archives-count">32</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/08/">八月 2016<span class="sidebar_archives-count">32</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/07/">七月 2016<span class="sidebar_archives-count">21</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/06/">六月 2016<span class="sidebar_archives-count">33</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/05/">五月 2016<span class="sidebar_archives-count">20</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/04/">四月 2016<span class="sidebar_archives-count">15</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/03/">三月 2016<span class="sidebar_archives-count">19</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/02/">二月 2016<span class="sidebar_archives-count">16</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/01/">一月 2016<span class="sidebar_archives-count">19</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/12/">十二月 2015<span class="sidebar_archives-count">20</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/11/">十一月 2015<span class="sidebar_archives-count">30</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/10/">十月 2015<span class="sidebar_archives-count">30</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/09/">九月 2015<span class="sidebar_archives-count">27</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/08/">八月 2015<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/07/">七月 2015<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/06/">六月 2015<span class="sidebar_archives-count">10</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/05/">五月 2015<span class="sidebar_archives-count">7</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/04/">四月 2015<span class="sidebar_archives-count">11</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/03/">三月 2015<span class="sidebar_archives-count">10</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/02/">二月 2015<span class="sidebar_archives-count">14</span></a></li><li><a class="sidebar_archives-link" href="/archives/2015/01/">一月 2015<span class="sidebar_archives-count">6</span></a></li><li><a class="sidebar_archives-link" href="/archives/2014/12/">十二月 2014<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2014/11/">十一月 2014<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2014/10/">十月 2014<span class="sidebar_archives-count">6</span></a></li><li><a class="sidebar_archives-link" href="/archives/2014/09/">九月 2014<span class="sidebar_archives-count">6</span></a></li><li><a class="sidebar_archives-link" href="/archives/2014/08/">八月 2014<span class="sidebar_archives-count">9</span></a></li><li><a class="sidebar_archives-link" href="/archives/2014/07/">七月 2014<span class="sidebar_archives-count">6</span></a></li><li><a class="sidebar_archives-link" href="/archives/2014/06/">六月 2014<span class="sidebar_archives-count">7</span></a></li><li><a class="sidebar_archives-link" href="/archives/2014/05/">五月 2014<span class="sidebar_archives-count">11</span></a></li><li><a class="sidebar_archives-link" href="/archives/2014/04/">四月 2014<span class="sidebar_archives-count">32</span></a></li><li><a class="sidebar_archives-link" href="/archives/2014/03/">三月 2014<span class="sidebar_archives-count">34</span></a></li><li><a class="sidebar_archives-link" href="/archives/2014/02/">二月 2014<span class="sidebar_archives-count">14</span></a></li><li><a class="sidebar_archives-link" href="/archives/2014/01/">一月 2014<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2013/12/">十二月 2013<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2013/07/">七月 2013<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2013/06/">六月 2013<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2013/04/">四月 2013<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2013/03/">三月 2013<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2013/02/">二月 2013<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2013/01/">一月 2013<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2012/12/">十二月 2012<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2012/10/">十月 2012<span class="sidebar_archives-count">6</span></a></li><li><a class="sidebar_archives-link" href="/archives/2012/09/">九月 2012<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2012/07/">七月 2012<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2012/06/">六月 2012<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2012/05/">五月 2012<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2011/08/">八月 2011<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2011/07/">七月 2011<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2011/06/">六月 2011<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2011/05/">五月 2011<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2011/04/">四月 2011<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2011/03/">三月 2011<span class="sidebar_archives-count">5</span></a></li><li><a class="sidebar_archives-link" href="/archives/2011/02/">二月 2011<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2010/12/">十二月 2010<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2010/11/">十一月 2010<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2010/09/">九月 2010<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2010/07/">七月 2010<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2010/06/">六月 2010<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2010/02/">二月 2010<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2010/01/">一月 2010<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2009/09/">九月 2009<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2009/07/">七月 2009<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2009/05/">五月 2009<span class="sidebar_archives-count">5</span></a></li><li><a class="sidebar_archives-link" href="/archives/2009/04/">四月 2009<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2009/03/">三月 2009<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2009/02/">二月 2009<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2008/07/">七月 2008<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2008/06/">六月 2008<span class="sidebar_archives-count">1</span></a>
            </ul>
        </li>
        
    

    <!-- Categories  -->
    

    <!-- Pages  -->
    

    <!-- Article Number  -->
    
</ul>


        <!-- Sidebar Footer -->
        <!--
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持和动力。 :)
-->

<!-- Sidebar Divider -->

    <div class="sidebar-divider"></div>


<!-- Theme Material -->

    <a href="https://github.com/viosey/hexo-theme-material"  class="sidebar-footer-text-a" target="_blank">
        <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
            主题 - Material
            <span class="sidebar-badge badge-circle">i</span>
        </div>
    </a>


<!-- Help & Support -->
<!--

-->

<!-- Feedback -->
<!--

-->

<!-- About Theme -->
<!--

-->

    </div>

    <!-- Sidebar Image -->
    

</aside>

                    

                    
                        <!-- Footer Top Button -->
                        <div class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>

                    

                    <!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
    
        <!-- Paradox Footer Left Section -->
        <div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    
        <a href="https://twitter.com/twitter" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-twitter.svg);">
                <span class="visuallyhidden">Twitter</span>
            </button><!--
     --></a>
    

    <!-- Facebook -->
    
        <a href="https://www.facebook.com/facebook" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-facebook.svg);">
                <span class="visuallyhidden">Facebook</span>
            </button><!--
     --></a>
    

    <!-- Google + -->
    
        <a href="https://www.google.com/" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-gplus.svg);">
                <span class="visuallyhidden">Google Plus</span>
            </button><!--
     --></a>
    

    <!-- Weibo -->
    

    <!-- Instagram -->
    

    <!-- Tumblr -->
    

    <!-- Github -->
    

    <!-- LinkedIn -->
    

    <!-- Zhihu -->
    

    <!-- Bilibili -->
    

    <!-- Telegram -->
    
</div>


        <!--Copyright-->
        <div id="copyright">
            Copyright&nbsp;©&nbsp;
            <script type="text/javascript">
                var fd = new Date();
                document.write(fd.getFullYear());
            </script>
            &nbsp;Hexo
        </div>

        <!-- Paradox Footer Right Section -->

        <!--
        I am glad you use this theme, the development is no so easy, I hope you can keep the copyright.
        It will not impact the appearance and can give developers a lot of support :)

        很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
        它不会影响美观并可以给开发者很大的支持。 :)
        -->

        <div class="mdl-mini-footer--right-section">
            <div>
                <div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
                <div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
            </div>
        </div>
    
</footer>


                    <!-- Import File -->

    <script src="/js/lazyload.min.js"></script>
    <script src="/js/js.min.js"></script>



    <script src="/js/nprogress.js"></script>


<script type="text/javascript">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    $('#nprogress .bar').css({
        'background': '#29d'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #29d, 0 0 15px #29d'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#29d',
        'border-left-color': '#29d'
    });
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>
















<!-- Window Load-->
<script>
    $(window).load(function() {
        // Post_Toc parent position fixed
        $('.post-toc-wrap').parent('.mdl-menu__container').css('position', 'fixed');
    });
</script>

<!-- MathJax Load-->

<script>
    <!-- Offer LazyLoad -->
    queue.offer(function(){
        $('.lazy').lazyload({
            effect : 'show'
        });
    });

    <!-- Start Queue -->
    $(document).ready(function(){
        setInterval(function(){
            queue.execNext();
        },200);
    });
</script>

                </main>
            </div>
        </body>
    
</html>
